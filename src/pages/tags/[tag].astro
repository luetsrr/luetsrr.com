---
import Layout from "../../layouts/Layout.astro";

type Post = {
  frontmatter: {
    tags: string[];
    title: string;
    date: string;
    update: string;
    description: string;
  };
  url: string;
};

export async function getStaticPaths() {
  const allPosts = await Astro.glob("../posts/*.md");
  const uniqueTags = [
    ...new Set(allPosts.map((post) => post.frontmatter.tags).flat()),
  ];
  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) =>
      post.frontmatter.tags.includes(tag)
    );
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;

const filteredPosts = posts.filter((post) =>
  post.frontmatter.tags.includes(tag)
);
---

<Layout title=`Tag: ${tag}ï½œluetsrr.com`>
  <div class="margin-contents text-color text-font">
    <span class="midashi mb-4">Tag: {tag}</span>
    <div style="height: 20px;"></div>
    <ul>
      {
        filteredPosts.map((post) => (
          <li>
            <a class="text-lg font-medium hover-color" href={post.url}>
              {post.frontmatter.title}
            </a>
            <br />
            {post.frontmatter.update ? (
              <div class="update-content">
                <i class="ri-calendar-2-line" />
                <a class="text-sm italic">{post.frontmatter.date}</a>
                &nbsp;
                <i class="ri-loop-left-line" />
                <a class="text-sm italic">{post.frontmatter.update}</a>
              </div>
            ) : (
              <div class="no-update-content">
                <i class="ri-calendar-2-line" />
                <a class="text-sm italic">{post.frontmatter.date}</a>
              </div>
            )}
            <a class="text-base">{post.frontmatter.description}</a>
            <div style="height: 24px;" />
          </li>
        ))
      }
    </ul>
  </div>
</Layout>
